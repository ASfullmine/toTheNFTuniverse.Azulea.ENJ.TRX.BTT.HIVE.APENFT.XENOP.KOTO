@Scripts.Render("~/bundles/jquery")
<script type='text/javascript'>

    $(document).ready(function () {

        buttonReadC

        $('#buttonReadC').click(function () {
            $('#textoModal').text('... Counting characters ...');
            $('#modalProcessing').modal('show');
            $('#textoModal').text('... You need ' + $('#textArea').val().length + ' characteres ...');
            $('#modalClose').removeAttr('disabled');
        });

        $('#buttonConv').click(function () {
            $('#textoModal').text('... Processing your request ...');
            $('#modalProcessing').modal('show');

            var data = new FormData();
            var token = $('[name=__RequestVerificationToken]').val();
            data.append("__RequestVerificationToken", token);
            var titulo = $('#titulo').val();
            data.append('titulo', titulo);
            var idioma = $('#idioma').val();
            data.append('idioma', idioma);
            var texto = $('#textArea').val();
            data.append('texto', texto);
            var voz = $('#voz').val();
            data.append('voz', voz);

            $.ajax({
                url: '../en/text_to_speech_pro',
                processData: false,
                contentType: false,
                cache: false,
                type: 'POST',
                data: data,
                success: function sfn(r) {
                    $('#textoModal').text(r);
                    if (r == '... ALL RIGHT =) ...') {
                        $('#textArea').val('');
                        $('#titulo').val('');
                        window.location.reload();
                    }
                },
                error: function myfunction() {
                },
                complete: function completefunc() {                    
                    $('#modalClose').removeAttr('disabled');
                    $("#modalClose").attr('class', 'btn-primary');
                    return false;
                }
            });
        });

        $('#modalProcessing').modal({
            backdrop: 'static',
            keyboard: false
        })

        $('#idioma').change(function () {
            $('#textoModal').text('... Loading ...');
            
            $('#modalProcessing').modal('show');

            $('#voz option').remove();

            var data = new FormData();

            var token = $('[name=__RequestVerificationToken]').val();
            data.append("__RequestVerificationToken", token);
            var idioma = $('#idioma').val();
            data.append("idioma", idioma);

            $.ajax({
                url: '../en/getVoices',
                processData: false,
                contentType: false,
                cache: false,
                type: 'POST',
                data: data,
                success: function sfn(r, textStatus, jqXHR) {
                    var select = document.getElementById('voz');
                    var data = r;
                    var options = "";
                    for (var i = 0; i < data.length; i++) {
                        options += `<option value=${data[i]}>${data[i]}</option>`;
                    }
                    $(select).append(options);
                },
                error: function myfunction(jqXHR, textStatus, errorThrown) {
                    alert('error');
                },
                complete: function completefunc() {
                    $('#modalProcessing').modal('hide');
                    $('#modalClose').removeAttr('disabled')
                    $("#modalClose").attr('class', 'btn-primary');
                    return false;
                }
            });
        });

        $('#epubB').click(function () {
            if (window.FormData !== undefined) {
                $('#textoModal').text('... Reading text ...');
                $('#modalProcessing').modal('show');

                // Create FormData object
                var fileData = new FormData();

                var token = $('[name=__RequestVerificationToken]').val();
                fileData.append("__RequestVerificationToken", token);

                var fileUpload = $("#file").get(0);
                var files = fileUpload.files;

                // Looping over all files and add it to FormData object
                for (var i = 0; i < files.length; i++) {
                    fileData.append(files[i].name, files[i]);
                }

                $.ajax({
                    url: '../en/getEPUBPDFText',
                    enctype: 'multipart/form-data',
                    processData: false,
                    contentType: false,
                    cache: false,
                    type: 'POST',
                    data: fileData,
                    success: function sfn(r, textStatus, jqXHR) {
                        $('#textArea').val(r);
                        //$('#modalProcessing').modal('hide');
                        // Su texto se ha leido correctamente
                    },
                    error: function myfunction(jqXHR, textStatus, errorThrown) {
                        //$('#modalProcessing').modal('hide');
                        //Ha ocurrido un error
                    },
                    complete: function completefunc() {
                        $('#modalProcessing').modal('hide');
                        $('#modalClose').removeAttr('disabled')
                        $("#modalClose").attr('class', 'btn-primary');
                        return false;
                    }

                });
            }
            else {
                alert('not file');
            }
        });

        $('#idioma').trigger("change");

    });
</script>
@{
    ViewBag.Title = "Professional Conversion";
}

<div class="row">
    <div class="col-md-12">
        <h1>Professional Conversion</h1>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        @if (Model is Int64)
        {
            <h3>It has @((Int64)Model) characters to convert.</h3>
            <a style="color:green;" href="../en/Characters">+ Characteres +</a>
        }
        else
        {
            <h3>There is an error in your character account, please contact your administrator</h3>
        }

    </div>
</div>
<br />
<form id="__AjaxAntiForgeryForm" action="#" method="post">@Html.AntiForgeryToken()</form>

<input id="file" type="file" name="file" accept=".epub, .pdf" />
<button id="epubB" class="btn btn-primary">read EPUB or PDF</button>


@*<form action="~/es/texto_a_voz_pro" method="post">
    @Html.AntiForgeryToken()*@
<div class="row">
    <div class="col-md-12">
        <h4>Título del archivo mp3:</h4>
        <input id="titulo" class="form-control" required name="titulo" type="text" style="width:400px;display:initial;" />
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h4>Language:</h4>
        <select id="idioma" class="form-control" required name="idioma" type="radio" style="width:400px;display:initial;" onchange="">
            <option value="en-US" selected>English</option>
            <option value="es-ES">Spanish</option>            
            <option value="fr-FR">French</option>
            <option value="de-DE">German</option>
            <option value="it-IT">Italian</option>
        </select>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h4>Voice:</h4>
        <select id="voz" class="form-control" required name="voz" type="radio" style="width:400px;display:initial;">
        </select>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <h4>Your text</h4>
        <textarea id="textArea" class="form-control" required name="texto" style="height:300px;display:initial;"></textarea>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <br />
        <input id="buttonReadC" type="button" class="btn btn-primary" value="Number of characters required?" />
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <br />
        <input id="buttonConv" type="button" class="btn btn-primary" value="convert to MP3" />
    </div>
</div>
@*</form>*@

<!-- Modal -->
<div id="modalProcessing" class="modal hide" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div id="modalBody" class="modal-body" style="text-align:center;width:100%;height:100%;">
                <p id="textoModal">... Loading ...</p>
                <button id="modalClose" class="disabled" data-dismiss="modal" aria-hidden="true" disabled>Close</button>
            </div>
        </div>
    </div>
</div>
